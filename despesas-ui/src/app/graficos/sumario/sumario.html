<span class="page-title">
    <i class="pi pi-chevron-right"></i> Sumário
</span>

<div class="form-panel" style="min-height: 650px;">

    <p-panel>

        <ng-template #header>
            <div class="flex items-center gap-2">
                <i class="pi pi-filter text-gray-600"></i>
                <span class="text-sm font-medium text-gray-700 whitespace-nowrap">Filtrar</span>
            </div>
        </ng-template>

        <div class="flex flex-row gap-4 items-center">

            <div class="flex flex-1 justify-center">
                <label for="dataInicial">
                    Vencimento Inicial:
                </label>
            </div>

            <div class="flex-1">
                <p-datepicker [iconDisplay]="'input'" [(ngModel)]="dataInicial" [showIcon]="true" inputId="icondisplay" />
            </div>

            <div class="flex flex-1 justify-center">
                <label for="dataInicial">
                    Vencimento Final:
                </label>
            </div>

            <div class="flex-1">
                <p-datepicker [iconDisplay]="'input'" [(ngModel)]="dataFinal" [showIcon]="true" inputId="icondisplay" />
            </div>

            <div class="flex flex-1 justify-center">
                <label for="conta">
                    Períodos:
                </label>
            </div>

            <div class="flex-1">
                <app-select-interval (onChange)="setDates($event)" />
            </div>

            <div class="flex flex-1 justify-center">
                <label for="conta">
                    Moeda:
                </label>
            </div>

            <div class="flex-1">
                <app-select-moeda (onSelect)="setMoeda($event)" />
            </div>

            <div class="flex flex-0 justify-end ml-20">
                <p-button label="Gerar" icon="pi pi-search" severity="info" size="small" (click)="generate()" [disabled]="!(!!dataInicial && !!dataFinal)" />
            </div>

        </div>

    </p-panel>

    @if (loading()) {
    <app-loader />
    } @else {

    @if (!primeiraVez) {

    <div class="mt-8 pt-8">

        <p-table [value]="tiposDespesa || []" [rowHover]="true">
            <ng-template pTemplate="header">
                <tr>
                    <th>Tipo/Mês</th>
                    @for (item of meses; track $index) {
                    <th class="force-center">{{item}}</th>
                    }
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-tipo>
                <tr>
                    <td>{{tipo}}</td>
                    @for(mes of meses; track $index){
                    <td class="force-center">{{getTotal(tipo,mes) | number: '1.2-2' : 'pt-BR'}}</td>
                    }
                </tr>
            </ng-template>
            <ng-template #footer>
                <tr>
                    <td><b>Total</b></td>
                    @for(mes of meses; track $index){
                    <td class="force-center">
                        <b>{{getTotalDespesas(mes) | number: '1.2-2' : 'pt-BR'}}</b>
                    </td>
                    }
                </tr>
                <tr>
                    <td><b>Receitas</b></td>
                    @for(mes of meses; track $index){
                    <td class="force-center">
                        <b>{{getTotalReceitas(mes) | number: '1.2-2' : 'pt-BR'}}</b>
                    </td>
                    }
                </tr>
                <tr>
                    <td><b>Saldo</b></td>
                    @for(mes of meses; track $index){
                    <td class="force-center">
                        <b>{{ getTotalReceitas(mes) - getTotalDespesas(mes) | number: '1.2-2' : 'pt-BR'}}</b>
                    </td>
                    }
                </tr>
            </ng-template>
        </p-table>

    </div>

    }
    }

</div>