<span class="page-title">
    <i class="pi pi-chevron-right"></i> Metas
</span>

<div class="form-panel">

    <div class="flex justify-between items-start pb-2.5">

        <div class="w-1/3">

            <p-panel>

                <ng-template #header>
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-gray-600"></i>
                        <span class="text-sm font-medium text-gray-700 whitespace-nowrap">Filtrar</span>
                    </div>
                </ng-template>

                <ng-template #footer>
                    <div class="flex justify-end">
                        <p-button label="Buscar" icon="pi pi-search" severity="info" size="small" (click)="filter()"/>
                    </div>
                </ng-template>

                <div class="flex gap-4 items-center">
                    <div class="flex-1">
                        <app-select-mes [initialValue]="mesSelecionado" (onSelect)="changeMes($event)"></app-select-mes>
                    </div>

                    <div class="flex-none">
                        <span class="text-gray-400 mx-5">de</span>
                    </div>

                    <div class="w-32">
                        <input pInputText type="number" [(ngModel)]="anoSelecionado" placeholder="AAAA" min="2000" max="2030" class="w-full">
                    </div>

                    <div class="flex-none">
                        <p-button icon="pi pi-calendar" severity="success" (click)="setToCurrentMonth()" />
                    </div>
                </div>

            </p-panel>
        </div>

        <div class="w-1/3"></div>

        <div class="w-1/3 flex justify-end">
            <p-button label="Adicionar" severity="secondary" (click)="add()">
                <i class="pi pi-plus text-2xl"></i>
            </p-button>
        </div>
    </div>

    @if (loading()) {
    <app-loader />
    }
    @else {
    <p-table
             #table
             stripedRows
             [value]="data"
             sortMode="single"
             [paginator]="true"
             [rows]="10"
             size="small"
             [rowsPerPageOptions]="[10, 15, 50, 100]"
             [globalFilterFields]="['cor', 'descricao']">

        <ng-template pTemplate="caption">
            <div style="display: flex; justify-content: flex-end">
                <p-iconField iconPosition="left" class="ml-auto">
                    <p-inputIcon>
                        <i class="pi pi-search"></i>
                    </p-inputIcon>
                    <input pInputText type="text" (input)="search()" [(ngModel)]="searchValue" placeholder="Buscar..." />
                </p-iconField>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="cor">
                    Descrição <p-sortIcon field="cor" />
                </th>
                <th pSortableColumn="descricao">
                    Valor <p-sortIcon field="descricao" />
                </th>
                <th>
                    Valor Diário <p-sortIcon field="saldo" />
                </th>
                <th class="small-column"></th>
                <th class="small-column"></th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-item>
            <tr>
                <td>
                    {{mes.getPorId(item.mes.mes - 1)?.name}} de {{item.mes.ano}}
                </td>
                <td> {{item.valor | number: '1.2-2' : 'pt-BR' }}</td>
                <td> {{item.valorDiario | number: '1.2-2' : 'pt-BR' }} </td>
                <td class="small-column">
                    <p-button icon="pi pi-pen-to-square" [outlined]="true" size="small" (click)="edit(item)" />
                </td>
                <td class="small-column">
                    <p-button icon="pi pi-trash" severity="danger" (click)="openDialog(item)" size="small" />
                </td>
            </tr>
        </ng-template>

    </p-table>
    }

</div>

<p-dialog header="Remover Contas Bancárias" [modal]="true" position="top" [(visible)]="showDialog" [style]="{ width: '50rem' }">
    Tem certeza que deseja remover <b>{{ meta?.descricao }}</b> ?

    <ng-template pTemplate="footer">
        <p-button label="Cancel" [raised]="true" severity="secondary" (click)="showDialog = false" />
        <p-button label="Save" [raised]="true" severity="success" (click)="remover()" />
    </ng-template>

</p-dialog>